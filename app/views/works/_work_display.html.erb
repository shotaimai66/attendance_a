
<%= render 'shared/error_messages', object: @work %>
<% y = @date.year %>
<% m = @date.month %>
<div>
　<!-- ヘッドのテーブル部分 -->
                <table class="table table-bordered">
                    <tr>
                        <td>
                            <% unless m=="4" %>
                            <%=  link_to "←", user_work_path(piyo: @date.prev_month), { :class => "btn btn-primary" } %>
                            <%end%>
                            <%= y %>年<%= m %>月の時間管理表
                            <% unless m=="3" %>
                            <%=  link_to "→", user_work_path(piyo: @date.next_month), { :class => "btn btn-primary" } %>
                            <%end%>
                        </td>    
                        <td>指定勤務開始時間  <%= "#{select_user.d_start_worktime.strftime("%H")}:#{select_user.d_start_worktime.strftime("%M")}" %><br>
                            指定勤務終了時間  <%= "#{select_user.d_end_worktime.strftime("%H")}:#{select_user.d_end_worktime.strftime("%M")}" %></td>
                        <td rowspan="1" colspan="3"><%=  sprintf("%.2f", basic_time ) %>  基本時間</td>
                        <td>初日 <%= "#{@date.month} / #{@date.beginning_of_month.day}" %></td>
                    </tr>
                    <tr>
                        <td>所属 <%= select_user.team %></td>
                        <td>氏名 <%= select_user.name %></td>
                        <td>コード</td>
                        <td></td>
                        <td>出勤日数 <%= select_user.works.where(day: Time.new(y,m).all_month).select("end_time").count %>日</td>
                        <td>締め <%= "#{@date.month} / #{@date.end_of_month.day}" %></td>
                    </tr>
                </table>
                
<!--【各種申請のお知らせ】表示-->
                <% if current_user.admin? %>
                    <%= render 'works/request_state' %>   
                <% end %>
                
<!-- 勤怠編集ボタン    -->
                <%= link_to "勤怠を編集", edit_user_work_path(piyo: @date), class: "btn btn-primary" %>
                <%= link_to "csv出力",user_csv_output_path(format: :csv, date: @date), class: "btn btn-primary" %>
                <br>
<!--修正ログ表示ボタン-->
                <%= link_to "勤怠修正ログ（承認済）", edit_user_work_path(piyo: @date), class: "btn btn-primary" %>
                
                
                
<!-- 最初の一行目    -->
                <table class="table table-bordered">
                    
                    <tr>
                        <td rowspan="3" colspan="1" >残業申請</td>
                        <td rowspan="3" colspan="1">日付</td>
                        <td rowspan="3" colspan="1" >曜日</td>
                        <td rowspan="1" colspan="8" >【実績】</td>
                        <td rowspan="1" colspan="5" >所定外勤務</td>
                    </tr>
                    <tr>
                        <td rowspan="1" colspan="3">出社</td>
                        <td rowspan="1" colspan="3" >退社</td>
                        <td rowspan="2" colspan="1" >在社時間</td>
                        <td rowspan="2" colspan="1" >備考</td>
                        <td rowspan="1" colspan="2" >終了予定時刻</td>
                        <td rowspan="2" colspan="1" >時間外時間</td>
                        <td rowspan="2" colspan="1" >業務処理内容</td>
                        <td cellpadding="bottom" align="right" rowspan="2" colspan="1">指示者確認印</td>
                    </tr>
                    <tr>
                        <td >時</td>
                        <td >分</td>
                        <td></td>
                        <td >時</td>
                        <td >分</td>
                        <td></td>
                        <td >時</td>
                        <td >分</td> 
                    </tr>
    
        
        
        
<!-- レコード表示部分 each文 -->
                <% days = (Date.new(y,m).all_month) %>
                　<!-- キーがdaysで値がcolorsの配列を作成し、CSSで各行の色分けをする  -->
                    <% colors = ["a","b","a","b","a","b","a","b","a","b","a","b","a","b","a","b","a","b","a","b","a","b","a","b","a","b","a","b","a","b","a"] %>
                    <% datas = Hash[*days.zip(colors).flatten(1)] %>
                    <% datas.each do |key, value| %>
                    <% work = select_user.works.find_by(day: key) %>
                <tr class="<%=value%>">
                    <!--モーダルウィンドウ（残業申請）-->
                        <td>
                            <button class="btn btn-primary" data-toggle="modal" data-target="#modal" data-date="<%=key.month%>/<%=key.day%>" data-date_1="<%=key.year%>-<%=key.month%>-<%=key.day%>" data-day="<%= %w(日 月 火 水 木 金 土)[key.wday]%>">
                                残業申請
                            </button>
                            <%= render 'works/modal_r_overwork' %>
                        </td>
                    <!--日付-->
                        <td><%=key.month%>/<%=key.day%></td>
                    <!--曜日-->
                        <td><%= %w(日 月 火 水 木 金 土)[key.wday]%></td>
                    <!--出社時間-->
                        <td><%=start_time(key) && start_time(key).hour%></td>
                        <td><%=start_time(key) && start_time(key).min%></td>
                    <!--出社ボタン-->
                        <td>
                            <% if key==Date.today && select_user.works.find_by(day: Date.today).start_time.blank?  %>
                                <%= button_to "出社", {:action => "create"},{ class: "btn btn-default btn-lg btn-block"}  %>
                            <% end %>
                        </td>
                    <!--退社時間-->
                        <td><%=start_time(key) && end_time(key) && end_time(key).hour%></td>
                        <td><%=start_time(key) && end_time(key) && end_time(key).min%></td>
                    <!--退社ボタン-->
                        <td>
                            <% if key==Date.today && select_user.works.find_by(day: Date.today) && select_user.works.find_by(day: Date.today).start_time && select_user.works.find_by(day: Date.today).end_time.nil? %>
                                <%= button_to "退社", {:action => "create"},{ class: "btn btn-default btn-lg btn-block"}  %>
                            <% end %>
                        </td>
                    <!--在社時間：(時間の差を求める際、カラム型がtimeとdatetimeで違うので注意。基本的にdatetimeを選択した方が無難)-->
                        <td><%=end_time(key) && start_time(key) && sprintf("%.2f", BigDecimal(((end_time(key) - start_time(key))/60/60).to_s).to_f ) %></td>
                    <!--備考-->
                        <td><%= select_user.works.find_by(day: key) && select_user.works.find_by(day: key).note %></td>
                    <!--終了予定時刻-->
                        <td><%=endtime_plan(key) && endtime_plan(key).strftime("%H")%></td>
                        <td><%=endtime_plan(key) && endtime_plan(key).strftime("%M")%></td>
                    <!--時間外時間-->
                        <td><%=sprintf("%.2f", overwork_time(work)) if work.endtime_plan %></td>
                    <!--業務処理内容-->
                        <td><%=work_content(key)%></td>
                    <!--指示者確認-->
                        <td><%=checker(key)%></td>
                    </tr>
                <% end %>
        
        
        
        
 <!-- 最後の一行 -->
                    <tr>
            　　　　　　<!-- 総合勤務時間の表示  --> 
            　　　　　　<td></td>
                        <td rowspan="1" colspan="2"><%= sprintf("%.2f", total_works_time(y,m)) %></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <!-- 在社時間の合計の表示  -->
                        <td><%=sprintf("%.2f", total_time(y,m).sum)%></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <!--所属長承認　月ごと-->
                        <td>
                            所属長承認  <%= month_check_window %><br>
                            <%= form_for @work, :url => { :controller => :works, :action => :create_monthwork },method: :post do %>
                            
                                <%= fields_for "work", @month_work do |fi| %>
                                    <%= fi.select :month_check, [["上長A", "上長A"],["上長B", "上長B"],["上長C", "上長C"]], {prompt: ""} %>
                                <% end %>
                                
                                <%= fields_for "work", @month_work do |fi| %>
                                    <%= fi.hidden_field :piyo, :value => params[:piyo] %>
                                <% end %>
                                
                                
                                <%= submit_tag "申請", class: "btn btn-primary" %>
                                
                            <% end %>
                        </td>
                    </tr>
                </table>

</div>




